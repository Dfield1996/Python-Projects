<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scrims Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/flowbite@latest/dist/flowbite.min.css" rel="stylesheet">
  <style>
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-enter {
      animation: fadeIn 0.2s ease-out;
    }
    
    .modal-content-enter {
      animation: slideUp 0.3s ease-out;
    }
    
    .scrim-card {
      transition: all 0.3s ease;
    }
    
    .scrim-card:hover {
      transform: translateY(-2px);
    }
    
    body {
      background: linear-gradient(135deg, #18181b 0%, #27272a 100%);
    }
  </style>
</head>
<body class="min-h-screen text-white">

<!-- Centered Navigation -->
<nav class="w-full px-6 py-4">
  <div class="max-w-5xl mx-auto flex justify-center gap-4">
    <a href="/scrims" class="px-4 py-2 rounded-lg shadow-lg text-white font-medium"
       style="background: linear-gradient(to right, #3b82f6, #8b5cf6);">
      Scrim Schedule
    </a>
    <a href="/availability" class="px-4 py-2 rounded-lg shadow-lg text-white font-medium"
       style="background: linear-gradient(to right, #3b82f6, #8b5cf6);">
      Player Availability
    </a>
  </div>
</nav>


  <div class="flex flex-col items-center p-6 w-full">
    <!-- Header Section -->
    <div class="w-full max-w-5xl mb-8">
      <div class="text-center mb-8">
        <h1 class="text-5xl font-bold mb-3 bg-gradient-to-r from-orange-400 via-red-400 to-pink-600 bg-clip-text text-transparent">
          ⚔️ Scrim Schedule ⚔️
        </h1>
        <p class="text-zinc-400 text-lg">Add edit or delete scrims</p>
      </div>

      <!-- Add Scrim Button -->
      <div class="flex justify-center">
        <button id="openAddScrim" class="group relative text-white px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl hover:shadow-blue-500/50 transition-all duration-300 hover:scale-105 flex items-center gap-2" style="background: linear-gradient(to right, #2563eb, #1d4ed8);">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
          </svg>
          Add New Scrim
        </button>
      </div>
    </div>

    <!-- Add Scrim Modal -->
    <div id="addScrimModal" class="hidden fixed top-0 left-0 right-0 bottom-0 z-50 w-full h-full flex items-center justify-center bg-black/60 backdrop-blur-sm modal-enter p-4">
      <div class="rounded-2xl shadow-2xl p-8 w-full max-w-md bg-zinc-800/90 backdrop-blur-xl text-white border border-zinc-700/50 modal-content-enter">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">Add Scrim</h3>
          <button id="closeAddScrim" class="text-zinc-400 hover:text-white transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        
        <form id="addScrimForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-zinc-300 mb-2">Team/VOD Name</label>
            <input name="name" placeholder="Enter team name..." class="w-full border border-zinc-600 rounded-lg p-3 bg-zinc-700/50 text-white placeholder-zinc-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" required>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-zinc-300 mb-2">Date</label>
            <input type="date" name="date" class="w-full border border-zinc-600 rounded-lg p-3 bg-zinc-700/50 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" required>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-zinc-300 mb-2">Start Time</label>
              <input type="time" name="start_time" class="w-full border border-zinc-600 rounded-lg p-3 bg-zinc-700/50 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" required>
            </div>
            <div>
              <label class="block text-sm font-medium text-zinc-300 mb-2">End Time</label>
              <input type="time" name="end_time" class="w-full border border-zinc-600 rounded-lg p-3 bg-zinc-700/50 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" required>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-zinc-300 mb-2">Contact</label>
            <input name="contact" placeholder="Discord username, IGN etc." class="w-full border border-zinc-600 rounded-lg p-3 bg-zinc-700/50 text-white placeholder-zinc-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
          </div>
          
          <div>
            <label class="block text-sm font-medium text-zinc-300 mb-2">Note</label>
            <input name="note" placeholder="Additional details..." class="w-full border border-zinc-600 rounded-lg p-3 bg-zinc-700/50 text-white placeholder-zinc-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
          </div>
          
          <div class="flex justify-end gap-3 mt-6">
            <button type="button" id="closeAddScrimBtn" class="px-5 py-2.5 rounded-lg text-white transition-all font-medium" style="background: #3f3f46;">Cancel</button>
            <button type="submit" class="px-5 py-2.5 rounded-lg text-white hover:shadow-lg hover:shadow-blue-500/50 transition-all font-medium" style="background: linear-gradient(to right, #2563eb, #1d4ed8);">Add Scrim</button>
          </div>
        </form>
        <p id="addScrimMessage" class="text-red-400 mt-3 hidden text-sm"></p>
      </div>
    </div>

    <!-- Scrims List -->
    {% for day, scrims in scrims_by_day.items() %}
      <div class="mt-8 w-full max-w-3xl">

        <!--Day header with gradient line-->
        <div class="flex items-center gap-4 mb-5">
          <div>
            <div style="background: linear-gradient(to right, #3b82f6, #8b5cf6); padding: 0.5rem 1rem; border-radius: 0.5rem; display: inline-block; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
              <h2 class="text-lg font-bold text-white whitespace-nowrap">{{ day }}</h2>
            </div>
          </div>
          <div class="flex-1 h-1 ml-4 rounded" style="background: linear-gradient(to right, #3b82f6, rgba(59,130,246,0));"></div>
        </div>
    

        <!-- Scrim Cards -->
        <div class="space-y-3">
          {% for scrim in scrims %}
            <div class="scrim-card rounded-xl shadow-lg p-5 flex justify-between items-start bg-gradient-to-br from-zinc-800/80 to-zinc-800/60 backdrop-blur border border-zinc-700/50 hover:border-blue-500/50">
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-3">
                  <div class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
                  <p class="font-bold text-xl text-white">{{ scrim.name }}</p>
                </div>
                
                <div class="flex items-center gap-2 text-zinc-300 mb-2">
                  <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <span class="font-medium">{{ scrim.time_display }}</span>
                </div>
                
                {% if scrim.contact %}
                  <div class="flex items-center gap-2 text-zinc-400 text-sm mb-1">
                    <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span>{{ scrim.contact }}</span>
                  </div>
                {% endif %}
                
                {% if scrim.note %}
                  <div class="flex items-start gap-2 text-zinc-400 text-sm mt-2">
                    <svg class="w-4 h-4 text-green-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span>{{ scrim.note }}</span>
                  </div>
                {% endif %}
              </div>
              
              <div class="flex gap-2 ml-4">
                <button
                  class="openEditScrim text-white px-4 py-2 rounded-lg font-medium shadow-md hover:shadow-lg hover:shadow-yellow-500/50 transition-all duration-300 hover:scale-105 flex items-center gap-2"
                  style="background: linear-gradient(to right, #eab308, #f97316);"
                  data-id="{{ scrim.id }}"
                  data-name="{{ scrim.name }}"
                  data-date="{{ scrim.date_iso }}"
                  data-start="{{ scrim.start_iso }}"
                  data-end="{{ scrim.end_iso }}"
                  data-contact="{{ scrim.contact or '' }}"
                  data-note="{{ scrim.note or '' }}"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                  </svg>
                  Edit
                </button>
                
                <button
                  class="deleteScrim text-white px-4 py-2 rounded-lg font-medium shadow-md hover:shadow-lg hover:shadow-red-500/50 transition-all duration-300 hover:scale-105 flex items-center gap-2"
                  style="background: linear-gradient(to right, #dc2626, #991b1b);"
                  data-id="{{ scrim.id }}"
                  data-name="{{ scrim.name }}"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                  Delete
                </button>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}

    <!-- Edit Scrim Modal -->
    <div id="editScrimModal" class="hidden fixed top-0 left-0 right-0 bottom-0 z-50 w-full h-full flex items-center justify-center bg-black/60 backdrop-blur-sm modal-enter p-4">
      <div class="rounded-2xl shadow-2xl p-8 w-full max-w-md bg-zinc-800/90 backdrop-blur-xl text-white border border-zinc-700/50 modal-content-enter">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-2xl font-bold bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent">Edit Scrim</h3>
          <button id="closeEditScrim" class="text-zinc-400 hover:text-white transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        
        <form id="editScrimForm" class="space-y-4">
          <input type="hidden" name="scrim_id" id="editScrimId">
          
          <div>
            <label class="block text-sm font-medium text-zinc-300 mb-2">Team/VOD Name</label>
            <input name="name" placeholder="Enter team name..." class="w-full border border-zinc-600 rounded-lg p-3 bg-zinc-700/50 text-white placeholder-zinc-500 focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all" required>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-zinc-300 mb-2">Date</label>
            <input type="date" name="date" class="w-full border border-zinc-600 rounded-lg p-3 bg-zinc-700/50 text-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all" required>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-zinc-300 mb-2">Start Time</label>
              <input type="time" name="start_time" class="w-full border border-zinc-600 rounded-lg p-3 bg-zinc-700/50 text-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all" required>
            </div>
            <div>
              <label class="block text-sm font-medium text-zinc-300 mb-2">End Time</label>
              <input type="time" name="end_time" class="w-full border border-zinc-600 rounded-lg p-3 bg-zinc-700/50 text-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all" required>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-zinc-300 mb-2">Contact</label>
            <input name="contact" placeholder="Discord username, email, etc." class="w-full border border-zinc-600 rounded-lg p-3 bg-zinc-700/50 text-white placeholder-zinc-500 focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
          </div>
          
          <div>
            <label class="block text-sm font-medium text-zinc-300 mb-2">Note</label>
            <input name="note" placeholder="Additional details..." class="w-full border border-zinc-600 rounded-lg p-3 bg-zinc-700/50 text-white placeholder-zinc-500 focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all">
          </div>
          
          <div class="flex justify-end gap-3 mt-6">
            <button type="button" id="closeEditScrimBtn" class="px-5 py-2.5 rounded-lg text-white transition-all font-medium" style="background: #3f3f46;">Cancel</button>
            <button type="submit" class="px-5 py-2.5 rounded-lg text-white hover:shadow-lg hover:shadow-yellow-500/50 transition-all font-medium" style="background: linear-gradient(to right, #eab308, #f97316);">Save Changes</button>
          </div>
        </form>
        <p id="editScrimMessage" class="text-red-400 mt-3 hidden text-sm"></p>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteScrimModal" class="hidden fixed top-0 left-0 right-0 bottom-0 z-50 w-full h-full flex items-center justify-center bg-black/60 backdrop-blur-sm modal-enter p-4">
      <div class="rounded-2xl shadow-2xl p-8 w-full max-w-md bg-zinc-800/90 backdrop-blur-xl text-white border border-zinc-700/50 modal-content-enter">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-2xl font-bold bg-gradient-to-r from-red-400 to-red-600 bg-clip-text text-transparent">Delete Scrim</h3>
          <button id="closeDeleteScrim" class="text-zinc-400 hover:text-white transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        
        <div class="mb-6">
          <p class="text-zinc-300 mb-4">Are you sure you want to delete this scrim?</p>
          <div class="bg-zinc-700/50 rounded-lg p-4 border border-zinc-600">
            <p class="font-bold text-lg" id="deleteScrimName"></p>
          </div>
        </div>
        
        <div class="flex justify-end gap-3">
          <button type="button" id="closeDeleteScrimBtn" class="px-5 py-2.5 rounded-lg text-white transition-all font-medium" style="background: #3f3f46;">Cancel</button>
          <button type="button" id="confirmDeleteScrim" class="px-5 py-2.5 rounded-lg text-white hover:shadow-lg hover:shadow-red-500/50 transition-all font-medium" style="background: linear-gradient(to right, #dc2626, #991b1b);">Delete Scrim</button>
        </div>
        
        <p id="deleteScrimMessage" class="text-red-400 mt-3 hidden text-sm"></p>
      </div>
    </div>
  </div>

  <script>
const addModal = document.getElementById('addScrimModal');
const addForm = document.getElementById('addScrimForm');
const closeAdd = document.getElementById('closeAddScrim');
const closeAddBtn = document.getElementById('closeAddScrimBtn');
const addMsg = document.getElementById('addScrimMessage');

document.getElementById('openAddScrim').addEventListener('click', () => addModal.classList.remove('hidden'));

const closeAddModal = () => {
  addModal.classList.add('hidden');
  addMsg.classList.add('hidden');
};

closeAdd.addEventListener('click', closeAddModal);
closeAddBtn.addEventListener('click', closeAddModal);
addModal.addEventListener('click', (e) => {
  if (e.target === addModal) closeAddModal();
});

let players = [];

async function loadPlayers() {
  try {
    const res = await fetch('/api/players');
    if (res.ok) {
      players = await res.json();
      console.log('Players loaded:', players);
    }
  } catch (err) {
    console.error('Failed to load players:', err);
  }
}

// Call it immediately
loadPlayers();

addForm.addEventListener('submit', async e => {
  e.preventDefault();
  addMsg.classList.add('hidden');

  const formData = new FormData(addForm);
  const name = formData.get('name');
  const date = formData.get('date');           // yyyy-mm-dd
  const start_time = formData.get('start_time'); // HH:MM
  const end_time = formData.get('end_time');     // HH:MM
  const contact = formData.get('contact');
  const note = formData.get('note');

  if (!name || !date || !start_time || !end_time) {
    addMsg.textContent = "Please fill in all required fields";
    addMsg.classList.remove('hidden');
    return;
  }


  
  try {
    // Fetch all players availability for the scrim date
const res = await fetch(`/api/availability_all?date=${date}`);
if (!res.ok) throw new Error("Failed to fetch availability");
const availabilityData = await res.json();

/*
availabilityData shape:
{
  "1": { "Monday 29/12/2025": { "18:00": "unavailable" } },
  "2": { "Monday 29/12/2025": { "18:00": "available" } }
}
*/

const normalizeTime = t => t.length === 5 ? t : '0' + t;

// Build day string EXACTLY how availability is stored
const dt = new Date(date);
const options = { weekday: 'long' };
const weekday = dt.toLocaleDateString('en-US', options); // e.g., "Monday"
const day = String(dt.getDate()).padStart(2, '0');        // "29"
const month = String(dt.getMonth() + 1).padStart(2, '0');// "12"
const year = dt.getFullYear();                            // 2025
const dayStr = `${weekday} ${day}/${month}/${year}`;      // "Monday 29/12/2025"

// Find unavailable players
const unavailablePlayers = [];

const parse12hTime = t => {
  // Convert "6PM" or "6:30PM" to "HH:MM" 24h format
  let hour = 0, minute = 0;
  const match = t.match(/^(\d{1,2})(?::(\d{2}))?(AM|PM)$/i);
  if (!match) return t; // already in 24h HH:MM format
  hour = parseInt(match[1], 10);
  minute = match[2] ? parseInt(match[2], 10) : 0;
  const ampm = match[3].toUpperCase();
  if (ampm === 'PM' && hour !== 12) hour += 12;
  if (ampm === 'AM' && hour === 12) hour = 0;
  return `${hour.toString().padStart(2,'0')}:${minute.toString().padStart(2,'0')}`;
};

const timeToMinutes = t => {
  const [h, m] = t.split(':').map(Number);
  return h * 60 + m;
};

const scrimStart = timeToMinutes(start_time);
const scrimEnd = timeToMinutes(end_time);

for (const playerId of Object.keys(availabilityData)) {
  const daySlots = availabilityData[playerId][dayStr];
  if (!daySlots) continue;

  for (const [time, status] of Object.entries(daySlots)) {
    const slotTime24 = parse12hTime(time); // convert to HH:MM
    const slotMinutes = timeToMinutes(slotTime24); // convert to minutes

    const playerObj = players.find(p => String(p.id) === String(playerId));
    const playerName = playerObj ? playerObj.name : `Player ${playerId}`;
    
    if (status === 'unavailable' && slotMinutes >= scrimStart && slotMinutes <= scrimEnd) {
      console.log(`Conflict found for player ${playerName} at ${slotTime24}`);
      unavailablePlayers.push(playerName);
      break;
    }
  }
}

if (unavailablePlayers.length > 0) {
  const confirmText = `Warning: the following player(s) are unavailable:\n\n${unavailablePlayers.join("\n")}\n\nContinue anyway?`;
  if (!confirm(confirmText)) return;
}

    // --- Proceed to submit ---
    const payload = { name, date, start_time, end_time, contact, note };
    try {
      const res = await fetch('/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      if (res.ok) {
        addModal.classList.add('hidden');
        addForm.reset();
        location.reload();
      } else {
        let errorText = 'Something went wrong';
        try {
          const result = await res.json();
          errorText = result.detail || result.error || errorText;
        } catch {
          errorText = await res.text();
        }
        addMsg.textContent = errorText;
        addMsg.classList.remove('hidden');
      }
    } catch {
      addMsg.textContent = 'Network error';
      addMsg.classList.remove('hidden');
    }

  } catch (err) {
    console.error(err);
    addMsg.textContent = "Failed to check player availability";
    addMsg.classList.remove('hidden');
  }
});

// Edit Scrim functionality
(() => {
  const modal = document.getElementById('editScrimModal');
  const form = document.getElementById('editScrimForm');
  const closeBtn = document.getElementById('closeEditScrim');
  const closeBtnSecond = document.getElementById('closeEditScrimBtn');
  const msg = document.getElementById('editScrimMessage');

  document.querySelectorAll('.openEditScrim').forEach(btn => {
    btn.addEventListener('click', () => {
      document.getElementById('editScrimId').value = btn.dataset.id;
      form.name.value = btn.dataset.name;
      form.date.value = btn.dataset.date;
      form.start_time.value = btn.dataset.start;
      form.end_time.value = btn.dataset.end;
      form.contact.value = btn.dataset.contact;
      form.note.value = btn.dataset.note;
      modal.classList.remove('hidden');
    });
  });

  const closeEditModal = () => {
    modal.classList.add('hidden');
    msg.classList.add('hidden');
  };

  closeBtn.addEventListener('click', closeEditModal);
  closeBtnSecond.addEventListener('click', closeEditModal);
  modal.addEventListener('click', (e) => {
    if (e.target === modal) closeEditModal();
  });

  form.addEventListener('submit', async e => {
    e.preventDefault();
    msg.classList.add('hidden');

    const formData = new FormData(form);
    const payload = Object.fromEntries(formData.entries());

    try {
      const res = await fetch('/edit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      if (res.ok) {
        modal.classList.add('hidden');
        form.reset();
        location.reload();
      } else {
        const result = await res.json();
        msg.textContent = result.detail || result.error || 'Something went wrong';
        msg.classList.remove('hidden');
      }
    } catch {
      msg.textContent = 'Network error';
      msg.classList.remove('hidden');
    }
  });

})();

// Delete Scrim functionality
(() => {
  const modal = document.getElementById('deleteScrimModal');
  const closeBtn = document.getElementById('closeDeleteScrim');
  const closeBtnSecond = document.getElementById('closeDeleteScrimBtn');
  const confirmBtn = document.getElementById('confirmDeleteScrim');
  const nameDisplay = document.getElementById('deleteScrimName');
  const msg = document.getElementById('deleteScrimMessage');
  let currentScrimId = null;

  document.querySelectorAll('.deleteScrim').forEach(btn => {
    btn.addEventListener('click', () => {
      currentScrimId = btn.dataset.id;
      nameDisplay.textContent = btn.dataset.name;
      modal.classList.remove('hidden');
    });
  });

  const closeDeleteModal = () => {
    modal.classList.add('hidden');
    msg.classList.add('hidden');
    currentScrimId = null;
  };

  closeBtn.addEventListener('click', closeDeleteModal);
  closeBtnSecond.addEventListener('click', closeDeleteModal);
  modal.addEventListener('click', (e) => {
    if (e.target === modal) closeDeleteModal();
  });

  confirmBtn.addEventListener('click', async () => {
    if (!currentScrimId) return;

    try {
      const res = await fetch('/delete', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ scrim_id: currentScrimId })
      });

      if (res.ok) {
        location.reload();
      } else {
        const result = await res.json();
        msg.textContent = result.error || 'Failed to delete scrim';
        msg.classList.remove('hidden');
      }
    } catch (error) {
      msg.textContent = 'Network error';
      msg.classList.remove('hidden');
    }
  });
})();
</script>

  <script src="https://unpkg.com/flowbite@latest/dist/flowbite.bundle.js"></script>
</body>
</html>